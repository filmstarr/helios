<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,minimum-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
<title>helios</title>
<script type="text/javascript" src="scripts\paper-full.min.js"></script>
<script type="text/paperscript" canvas="canvas">


	//Debugging
	var debug = true;


  //Define plot variables
  var secondsInDay = 60 * 60 * 24;
  var sunRadius = 10;
  var xBuffer = 0;
  var yBuffer = 1 + sunRadius;
	var ySize = 200;
	var xSize = ((window.innerWidth > 0) ? window.innerWidth : screen.width) - (2 * xBuffer);
  var framesPerSecond = 1;
  var lineColour = "white";
  if (debug) {
    framesPerSecond = 600;
    lineColour = "black";
  }


  //Retrieve sunrise, sunset and midday times 
  var sunrise = new Date(2000, 1, 1, 5, 0, 0, 0);
  var sunset = new Date(2000, 1, 1, 22, 0, 0, 0);
  var degreeMidday = fractionalMidday() * 360;


  //Draw wave - ToDo: recalculate wave perioducally
  var pathPoints = 360;
	var wave = new Path();
	for (var i = 0; i <= pathPoints; i++) {
		var point = new Point(xBuffer + ( xSize * i / pathPoints), yBuffer + altitude(i / pathPoints));
		wave.add(point);
	}
  wave.strokeColor = lineColour;
  wave.smooth();
  wave.simplify();

  //Draw horizon
  var from = new Point(xBuffer, 0);
  var to = new Point(xBuffer + xSize, 0);
  var horizon = new Path.Line(from, to);
  horizon.strokeColor = lineColour;
  sightHorizon();

  //Draw the sun
  var helios = new Path.Circle(0,0,sunRadius);
  helios.strokeColor = lineColour;
  helios.fillColor = lineColour;
 	sightSun();


  //Parameters
  function altitude(fractionalTime) {
    var degreeTime = 360 * fractionalTime;
    var fractionalAltitude = (1 + Math.cos((degreeTime + 180 - degreeMidday) * Math.PI / 180)) / 2;
    return fractionalAltitude * ySize;
  }

  function fractionalTime(date) {
  	var seconds = secondsSinceStartOfDay(date);
		return seconds / secondsInDay;
  }

  function fractionalMidday() {
    var midday = (secondsSinceStartOfDay(sunset) + secondsSinceStartOfDay(sunrise)) / 2;
    return midday / secondsInDay;
  }

  function secondsSinceStartOfDay(date) {
    return date.getSeconds() + (60 * date.getMinutes()) + (60 * 60 * date.getHours());
  }


  //Update items
  function sightHorizon() {
    var horizonAltitude = altitude(fractionalTime(sunrise));

    var yHorizon = yBuffer + horizonAltitude;
    var segments = horizon.segments;
    for (var i = 0; i < segments.length; i++) {
      var segment = segments[i];
      segment.point.y = yHorizon;
    }
  }

  function sightSun() {
    var date = new Date();
    var timeFraction = fractionalTime(date);
    if (debug) {
      timeFraction = (date.getMilliseconds() + ((date.getSeconds() % 10) * 1000)) / (1000 * 10);
    }
    helios.position.x = xBuffer + (xSize * timeFraction);
    helios.position.y = yBuffer + altitude(timeFraction);
  }


  //Animate
  var throttleDate = new Date();
  function onFrame(event) {
    var date = new Date();
  	if (date - throttleDate >= 1000 / framesPerSecond) {
      sightSun();
      throttleDate = date;
    }
  }

</script>
</head>

<body style="margin: 0; padding-top: 200px;">
	<canvas id="canvas" resize></canvas>
</body>

</html>